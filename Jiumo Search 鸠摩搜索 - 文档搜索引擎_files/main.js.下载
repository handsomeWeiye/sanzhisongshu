var g_ischina=!0,g_forced=!1,g_device="normal",g_ip="",g_parsed=[],dls_show=[],previous_search="",current_search="",log_enabled=!1;function c_log(e){log_enabled&&console.log(e)}function share_record(e,t){return e&&link_clicked(t),!1}function cronjob(){var e=new XMLHttpRequest;return e.open("POST","cronjob.php",!0),e.setRequestHeader("Content-type","application/x-www-form-urlencoded"),e.setRequestHeader("X-Requested-With","XMLHttpRequest"),e.send(),!1}function Pageloaded(){return weixinTip(),cronjob(),wechat_overlay_load(),google_analytics(),setCookie("loaded",g_loaded_plus,30),700<window.innerWidth&&null!==document.getElementById("SearchWord")&&document.getElementById("SearchWord").focus(),adjust_screen(),!1}function adjust_screen(){var e=530,t=window.innerHeight;700<window.innerWidth&&689<t&&(e=t-159,document.getElementById("google-div").setAttribute("style","height:"+e+"px;"),document.getElementById("forum-div").setAttribute("style","max-height:"+e+"px;"))}function weixinTip(){var e=navigator.userAgent,t=!!/MicroMessenger/i.test(e),n=!!/iPhone OS/i.test(e);t&&(document.getElementById("JweixinTip").style.display="block",document.getElementById("wxtip-txt").innerHTML=n?"请点击右上角<br/>选择在Safari中打开":"请点击右上角<br/>选择在浏览器中打开")}function google_analytics(){var e,t,n,i,o,r;e=window,t=document,n="script",i="ga",e.GoogleAnalyticsObject=i,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,o=t.createElement(n),r=t.getElementsByTagName(n)[0],o.async=1,o.src="//www.google-analytics.com/analytics.js",r.parentNode.insertBefore(o,r),ga("create","UA-63432350-1","auto"),ga("send","pageview")}function setCookie(e,t,n){var i=new Date;i.setTime(i.getTime()+24*n*60*60*1e3);var o="expires="+i.toUTCString();document.cookie=e+"="+t+"; "+o}function themeChanged(){var e=document.getElementById("theme");return current_theme="dark"===current_theme?"bright":"dark",setCookie("theme",current_theme,30),e.setAttribute("href","Style/Main_"+current_theme+".css"+g_css_appendix),link_clicked("theme changed to "+current_theme),!1}function load_mainpage(){var e=document.getElementById("main-form").getAttribute("class");if("mainform_search"===e)window.location=window.location.pathname;else if("mainform"===e){var t=g_image_link;0<t.length&&window.open(t,"_blank")}return!1}function focusinput(){window.innerWidth<700&&validate("");var e=document.getElementById("SearchWord");return e.removeAttribute("onfocus"),e.focus(),!0}function status_result(e,t,n,i,o,r){var a=new XMLHttpRequest;return a.open("POST","status_result.php",!0),a.setRequestHeader("Content-type","application/x-www-form-urlencoded"),a.setRequestHeader("X-Requested-With","XMLHttpRequest"),a.send("action="+encodeURIComponent(e)+"&c="+encodeURIComponent(t)+"&q="+encodeURIComponent(n)+"&status="+encodeURIComponent(i)+"&log="+encodeURIComponent(o)+"&data_length="+encodeURIComponent(r)),!1}function link_clicked(e){var t=new XMLHttpRequest;return t.open("POST","link_clicked.php",!0),t.setRequestHeader("Content-type","application/x-www-form-urlencoded"),t.setRequestHeader("X-Requested-With","XMLHttpRequest"),t.send("q="+encodeURIComponent(e)),!1}window.alert=function(){};var g_word="",status_hub=[],status_hub_count=0,g_id=-1,hsp_arr=window.location.hostname.split("."),hs_base="."+hsp_arr[hsp_arr.length-2]+"."+hsp_arr[hsp_arr.length-1],g_hostname_arr=["www"+hs_base,"www2.jiumodiary.com","www5.jiumodiary.com"];function ajax_fetch_hub(s,e){function t(a,l){return function(){if(4===l.readyState&&200===l.status){if(d)return void c_log("abandant ajax "+a);if(d=!0,g_id!==s)return;var e=l.responseText,t=JSON.parse(e),n=t.status,i=t.status_extra,o=t.log;status_hub_count=parseInt(t.count);var r=t.sources;return c_log(n+": "+o+", new_count:"+status_hub_count),"succeed"===n&&(status_hub=status_hub.concat(r),"completed"!==i&&ajax_fetch_hub(s,status_hub_count)),void render(i)}}}for(var d=!1,n=[],i=0;i<g_hostname_arr.length;i++){var o=g_hostname_arr[i];n[o]=new XMLHttpRequest,n[o].onreadystatechange=t(o,n[o]),n[o].open("POST","https://"+o+"/ajax_fetch_hubs.php",!0),n[o].setRequestHeader("Content-type","application/x-www-form-urlencoded"),n[o].setRequestHeader("X-Requested-With","XMLHttpRequest"),n[o].send("id="+encodeURIComponent(s)+"&set="+encodeURIComponent(e)),c_log("ajax request : "+o+", id="+encodeURIComponent(s)+"&set="+encodeURIComponent(e))}}function init_fetch_hub(e){function t(i,o){return function(){if(4===o.readyState&&200===o.status){if(r)return void c_log("abandant init "+i);r=!0;var e=o.responseText,t=JSON.parse(e),n=t.status;return"succeed"!==n?(hide_loading(),"exceed"===n?void exceed_alert():"tooshort"===n?void tooshort_alert():void notfound_alert()):(status_hub=t.sources,status_hub_count=parseInt(t.count),c_log("g_id received: "+(g_id=t.id)),ajax_fetch_hub(g_id,status_hub_count),void render("more"))}}}for(var n=(new Date).getTime(),r=!1,i=[],o=0;o<g_hostname_arr.length;o++){var a=g_hostname_arr[o];i[a]=new XMLHttpRequest,i[a].onreadystatechange=t(a,i[a]),i[a].open("POST","https://"+a+"/init_hubs.php",!0),i[a].setRequestHeader("Content-type","application/x-www-form-urlencoded"),i[a].setRequestHeader("X-Requested-With","XMLHttpRequest"),i[a].send("q="+encodeURIComponent(e)+"&remote_ip="+g_ip+"&time_int="+n),c_log("init request : "+a+",  q="+encodeURIComponent(e)+"&remote_ip="+g_ip+"&time_int="+n)}}function render(e){c_log("render - "+e+" - "+status_hub_count),"completed"!==e?more_loading():hide_loading(),view=[],uls=[],window.innerWidth<=700?render_mobile():render_normal(),localbook_refresh(),"completed"!==e||0!==view.length||notfound_alert()}function render_mobile(){for(var e in status_hub){var t=status_hub[e].view_type;if("succeed"===status_hub[e].details.status){var n=status_hub[e].details.data;switch(t){case"view_forum":for(var i in n){var o=n[i].data;for(var r in o)o[r].info=status_hub[e].info,o[r].view_type=t;push_view_main(o)}break;case"view_local":n=n.slice(0,1);default:for(var r in n)n[r].info=status_hub[e].info,n[r].view_type=t;push_view_main(n)}}}}function render_normal(){for(var e in status_hub){var t=status_hub[e].view_type;if("succeed"===status_hub[e].details.status){var n=status_hub[e],i=status_hub[e].details.data;switch(t){case"view_forum":case"view_sidebar":split_panel(),push_view_sidebar(n);break;default:for(var o in i)i[o].info=status_hub[e].info,i[o].view_type=t;push_view_main(i)}}}}function startsearch(){var e=document.getElementById("SearchWord").value;return 0===e.length||e===previous_search||(validate(current_search=e),previous_search=e,setTimeout(function(){previous_search=""},2e3)),!1}function validate(e){var t=document.getElementById("notification");t&&(t.style.display="none"),document.getElementById("SearchWord").blur();var n=document.getElementById("SearchButton"),i=document.getElementById("loading-icon"),o=document.getElementById("result-panel"),r=document.getElementById("result-panel-middle"),a=document.getElementById("google-div"),l=(document.getElementById("google-result-div"),document.getElementById("format-filter")),s=document.getElementById("google-panel"),d=document.getElementById("forum-panel"),u=document.getElementById("forum-div"),c=document.getElementById("main-form"),m=document.getElementById("row-1"),p=document.getElementById("row-2"),h=document.getElementById("row-3"),g=(document.getElementById("row-1-link"),document.getElementById("icon-wrapper")),_=document.getElementById("theme-div"),f=document.getElementById("logo"),v=document.getElementById("label-div");return document.documentElement.scrollTop=0,document.body.scrollTop=0,c.setAttribute("class","mainform_search"),m.setAttribute("class","row1_search"),p.setAttribute("class","row2_search"),h.setAttribute("class","row3_search"),f.style.display="none",v.style.display="none",r.setAttribute("class","result-panel-middle-hide"),s.setAttribute("class","google-panel-width"),u.innerHTML="",u.style.display="none",d.style.display="none",l.style.display="none",l.innerHTML="",o.style.display="",a.style.display="",g.appendChild(_),g.setAttribute("class","row4_search"),document.getElementById("result-ul").innerHTML="",g_parsed=[],status_hub=[],fetched=[],hub_word=e,g_id=-1,view=[],dls_show=[],uls=[],window.innerWidth<=700&&(n.innerHTML=""),""!==e&&(i.style.display="",init_fetch_hub(e)),!1}var format=["PDF","TXT","MOBI","EPUB","AZW","DOC"],format_exp=[/pdf/i,/txt/i,/mobi(?!le)/i,/epub/i,/azw/i,/doc(?!ument)/i],format_other="OTHER";function get_format_exp(e){for(var t=0;t<format.length;t++)if(format[t].toUpperCase()===e.toUpperCase())return format_exp[t];return!1}var format_sum=[];function addto_format_sum(e){for(var t=0;t<format_sum.length;t++)if(format_sum[t][0]===e)return format_sum[t][1]+=1,!1;format_sum.push([e,1])}function render_main(e){var t="";if("view_local"!==e.view_type)return"img_link"in e?(t+='<li style="list-style:none; line-height:1.2; margin-bottom:10px;">',t+='<div style="display: inline-block;max-width: 70px; width:20%; line-height:87px;height:90px;text-align:center;border: 1px solid rgba(128,128,128,0.5);">',t+='<a rel="noreferrer external nofollow" href="'+e.link+'" target="_blank"><img src="'+e.img_link+'" style="vertical-align: middle; max-width:100%; max-height:100%"></a></div>',t+='<div class="priced_item_left" style="margin-left:1%; width:78%">',t+='<div class="title" style="line-height:1.5em; max-height:1.5em;"><a rel="noreferrer external nofollow" target="_blank" href="'+e.link+'"><span width="100%" style="font-size: 18px;font-family: arial,sans-serif;">'+e.title+"</span></a></div>",t+="v_right1"in e?'<div style="line-height:1.3em; max-height:2.5em;">':'<div style="line-height:1.3em; max-height:3.7em;">',t+=e.v_des.replace("<br>",". ")+"</div>","v_right1"in e&&(t+='<div><span style="display:inline-block; margin-top:2px; margin-bottom:2px;">',"v_right2"in e&&(t+="v_right2_link"in e?'<a rel="noreferrer external nofollow" target="_blank" href="'+e.v_right2_link+'"><span style="background-color: #A0522D;font-size: small;color: white;padding: 0px 2px; margin-right:5px; border-radius: 2px 2px;">'+e.v_right2+"</span></a>":'<span style="background-color: #A0522D;font-size: small; color: white;padding: 0px 2px; margin-right:5px; border-radius: 2px 2px;">'+e.v_right2+"</span>"),t+='<span style="background-color: #A0522D;font-size: small; color: white;padding: 0px 2px; border-radius: 2px 2px;">'+e.v_right1+"</span>",t+="</span></div>"),t+='<div class="span-host" style="font-weight: bold; font-size: 14px;">'+e.host+"</div></div>",t+="</li>"):(t='<li style="list-style:none; line-height:1.2;"><div style="margin-bottom:15px;">',t+='<div><a rel="noreferrer external nofollow" href="'+e.link+'" target="_blank" ><span style="font-size: 18px; font-family: arial,sans-serif;">'+e.title+"<span></a></div>",t+='<div class="span-des" >'+e.des+"</div>",t+='<div class="span-host" style="font-weight: bold; font-size: 13px;">'+e.host+e.log+"</div>",t+="</div></li>");var n='<a class="localbook_download" href="'+e.link+'" target="_blank" style="margin-right:10px; color:white; padding: 2px 4px; border-radius:4px; background-color: /*olive*/ #A0522D; font-size:13px; vertical-align:top; display:none;">Download</a>',i='<a class="localbook_download" href="'+e.link.replace("http://doudouso.com","https://dd.doudouso.com")+'" target="_blank" style="margin-right:10px; color:white; padding: 2px 4px; border-radius:4px; background-color: /*olive*/ #A0522D; font-size:13px; vertical-align:top; display:none;">Download2</a>';return t+='<li style="list-style: none; line-height: 1.2;"><div>',t+='<div><a href="#" book-data="'+e.link+'" onclick="return localbook_click(this);"; ><span style="margin-right:4px; color:white; padding: 2px 4px; border-radius:4px; background-color:rgb(160, 82, 45); font-size:13px; vertical-align:top; display:none;">⬇</span><span style="font-size: 18px; font-family: arial,sans-serif;">'+e.title+"</span></a></div>",t+="<div>"+n+i+"</div>",t+='<div class="span-des" >'+e.des+"</div>",t+='<div class="span-host" style="font-weight: bold; font-size: 13px;">'+e.log+"</div>",t+="</div></li>"}var view=[];format_sum=[];function push_view_main(e){for(var t=document.getElementById("result-ul"),n="",i=0;i<e.length;i++){e[i].rate_summary=parseInt(e[i].rate_summary),e[i].pos=view.length+i;for(var o=!1,r=0;r<view.length;r++)if(e[i].link===view[r].link){view[r].info+="; "+e[i].info,o=!0;break}o||view.push(e[i])}if(view.sort(function(e,t){return 1e3*(t.rate_summary-e.rate_summary)+(e.pos-t.pos)}),0===view.length)return!1;for(i=0;i<view.length;i++)view[i].log="",log_enabled&&(view[i].log=" - "+view[i].info+" - "+view[i].rate_title+"|"+view[i].rate_des+" - "+view[i].rate_summary),n+=render_main(view[i]);t.innerHTML=n,format_sum=[];for(i=0;i<view.length;i++){view[i].des||(view[i].des="");var a=!1;for(r=0;r<format.length;r++)(view[i].title.match(format_exp[r])||view[i].des.match(format_exp[r]))&&(addto_format_sum(format[r]),a=!0);a||addto_format_sum(format_other)}format_sum.sort(function(e,t){return e[0]===format_other?1:t[0]===format_other?-1:t[1]-e[1]});var l=document.getElementById("format-filter"),s=[];if(2<=format_sum.length){for(i=0;i<format_sum.length;i++){var d='<a id="'+format_sum[i][0]+'" href="#" onclick="return filter_content(\''+format_sum[i][0]+"')\">"+format_sum[i][0]+"("+format_sum[i][1]+")</a>";s.push(d)}d=s.join(" | ");l.innerHTML=d}}var uls=[];function push_view_sidebar(e){"view_forum"===e.view_type&&uls.push([e.view_type_sidebar_priority,generate_ul_forum(e)]),"view_sidebar"===e.view_type&&uls.push([e.view_type_sidebar_priority,generate_ul_sidebar(e)]),uls.sort(function(e,t){return parseInt(e[0])-parseInt(t[0])});for(var t="",n=0;n<uls.length;n++)t+=uls[n][1];document.getElementById("forum-div").innerHTML=t}function generate_ul_forum(e){var t=e.details.data,n='<div style="color: rgb(221, 221, 221); margin-top: 15px; margin-left: 10px; margin-right: 10px;">';for(var i in t){var o=t[i].title,r=t[i].data;if(r){for(var e in n+='<span class="span-host">'+o+":</span>",n+="<ul>",r)n+='<li><a rel="noreferrer external nofollow" target="_blank" href="'+r[e].link+'">'+r[e].title+"</a></li>";n+="</ul>"}}return n+="</div>"}function generate_ul_sidebar(e){var t=e.details.data,n='<div style="color: rgb(221, 221, 221); margin-top: 15px; margin-left: 10px; margin-right: 10px;">';e.view_host_link?n+='<a rel="noreferrer external nofollow" target="_blank" href="'+e.view_host_link+'"><span class="span-host" style="font-weight:bold;">'+e.view_host+"</span></a>":n+='<span class="span-host" style="font-weight:bold;">'+e.view_host+"</span>",n+='<ul style="padding-left: 0px;">';for(var i=0;i<t.length;i++)line=t[i],n+='<li style="margin-bottom:10px;">',n+='<div style="display: inline-block; width: 20%; line-height:87px; height:90px; text-align:center; border: 1px solid rgba(128,128,128,0.5);">',n+='<a rel="noreferrer external nofollow" href="'+line.link+'" target="_blank"><img src="'+line.img_link+'" style="vertical-align: middle; max-width:100%; max-height:100%"></a></div>',n+='<div class="priced_item_left" style="margin-left:1%; width:78%">',"v_right1"in line&&(n+='<div class="priced_item_right" style="width:120px"><span style="display:inline-block;float:right;">',"v_right2"in line&&("v_right2_link"in line?n+='<a rel="noreferrer external nofollow" target="_blank" href="'+line.v_right2_link+'"><span style="background-color: #A0522D;font-size: small;color: white;padding: 0px 2px;border-radius: 2px 2px;">'+line.v_right2+"</span></a>":n+='<span style="background-color: #A0522D;font-size: small;color: white;padding: 0px 2px;border-radius: 2px 2px;">'+line.v_right2+"</span>"),n+='<span style="background-color: #A0522D;font-size: small;color: white;padding: 0px 2px;margin-left: 5px;border-radius: 2px 2px;">'+line.v_right1+"</span></div>"),n+='<div class="title" style="line-height:1.5em; max-height:3em;"><a rel="noreferrer external nofollow" target="_blank" href="'+t[i].link+'" style="font-weight: bold;"><span width="100%">'+t[i].title+"</span></a></div>",n+='<div class="des" style="line-height:1.3em; max-height:3.7em;">'+line.v_des+"</div>",n+="</li>";return n+="</ul></div>"}function split_panel(){var e=document.getElementById("forum-div"),t=document.getElementById("forum-panel"),n=document.getElementById("google-panel"),i=document.getElementById("result-panel-middle");"google-panel-width-backup"!==n.getAttribute("class")&&n.setAttribute("class","google-panel-width-narrow"),e.style.display="",t.style.display="inline-block",i.setAttribute("class","result-panel-middle-show"),document.getElementById("priced-filter").innerHTML="FORUM & PRINTED BOOK"}function notfound_alert(){hide_loading();var e=document.getElementById("SearchWord").value,t="";t='<div style="font-size: 16px;"><br>没有找到与<b>"'+e+'"</b>相关的文档.<br>可以减少搜索限制或换个名字尝试.</div>',t+='<div style="font-size: 16px;"><br><b>'+e+'</b> - is not found.<br><br>Suggestions: <br><ul style="line-height: 1.2;margin-top: 10px;"><li>Make sure all words are spelled correctly.</li><li>Try different keywords.</li><li>Try more general keywords.</li></ul></div>',document.getElementById("result-ul").innerHTML=t}function exceed_alert(){document.getElementById("result-ul").innerHTML='<div style="font-size: 16px;"><br><span style="font-weight:bold;">Information</span><br><br> - You have reached search limits today, some results will not be able to show. Please try again tomorrow. Thanks.</div><div style="font-size: 17px;"><br><span style="font-size: 18px; font-weight:bold">提示</span><br><br> - 您的查询已达到今日的最高次数, 一些结果将无法显示. 请明日再试. 谢谢.</div>'}function tooshort_alert(){document.getElementById("result-ul").innerHTML='<div style="font-size: 16px;"><br><span style="font-weight:bold;">Information</span><br><br> - Invalid Search. Please try again. Thanks.</div><div style="font-size: 17px;"><br><span style="font-size: 18px; font-weight:bold">提示</span><br><br> - 您查询的内容过短, 请重试. 谢谢.</div>'}function filter_content(e){for(var t=document.getElementById("result-ul"),n=document.getElementById("google-div"),i=document.getElementById("format-filter").getElementsByTagName("a"),o=0;o<i.length;o++)i[o].getAttribute("id")===e?i[o].setAttribute("style","font-weight: bolder;"):i[o].setAttribute("style","font-weight: normal;");var r=[];r=e===format_other?filter_other():filter_format(e);var a="";for(o=0;o<r.length;o++)a+=render_main(r[o]);return t.innerHTML=a,n.scrollTop=0,!(dls_show=[])}function filter_format(e){for(var t=get_format_exp(e),n=[],i=0;i<view.length;i++){var o=!1;if((view[i].title.match(t)||view[i].des.match(t))&&(o=!0),o){var r=Object.assign({},view[i]),a=r.title,l=r.des,s='<span class="highlight">'+a.match(t)+"</span>",d='<span class="highlight">'+l.match(t)+"</span>";r.title=a.split(t).join(s),r.des=l.split(t).join(d),n.push(r)}}return n}function filter_other(){for(var e=[],t=0;t<view.length;t++){for(var n=!1,i=0;i<format.length;i++)if(view[t].title.match(format_exp[i])||view[t].des.match(format_exp[i])){n=!0;break}n||e.push(view[t])}return e}function hide_loading(){var e=document.getElementById("format-filter");e&&(e.style.display="inline-block");var t=document.getElementById("format-loading");t&&(t.style.display="none");var n=document.getElementById("loading-icon");n&&(n.style.display="none");var i=document.querySelector("#loading-icon img");i&&(i.style="")}function more_loading(){var e=document.getElementById("format-filter");e&&(e.style.display="none");var t=document.getElementById("format-loading");t&&(t.style.display="inline-block");var n=document.querySelector("#loading-icon img");n&&(n.style.width="35px")}function localbook_click(e){for(var t=e.parentElement.parentElement.querySelectorAll(".localbook_download"),n=0;n<t.length;n++){var i=t[n],o=dls_show.indexOf(i.href);0<=o?dls_show.splice(o,1):dls_show.push(i.href)}return localbook_refresh(),!1}function localbook_refresh(){for(var e=document.querySelectorAll(".localbook_download"),t=0;t<e.length;t++)0<=dls_show.indexOf(e[t].href)?e[t].style.display="inline-block":e[t].style.display="none"}function wechat_overlay_load(){if(document.body){document.body.innerHTML+='<div id="wechat-overlay" onclick="wechat_overlay_hide();" style="display:none; position: absolute; width: 100%; height: 100%; top: 0px; left: 0px; z-index: 100; text-align:center; vertical-align:middle; background-color: rgba(0,0,0,0); padding-top: 150px;"><img style="max-width:100%; border: solid 2px grey; border-radius: 5px 5px;" src="images/wechat_public_barcode3.gif"></div>'}return!0}function wechat_overlay_show(){var e=document.getElementById("wechat-overlay");return!e||!(e.style.display="block")}function wechat_overlay_hide(){var e=document.getElementById("wechat-overlay");return e&&(e.style.display="none"),!0}